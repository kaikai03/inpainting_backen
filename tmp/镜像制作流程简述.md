#镜像制作流程

##一、建立/找到基本环境。

方式一：自建

	基于alpine来建立镜像，这是一个简化的linux，docker pull 一个镜像到本地。


	编写dockerfile， 基于alpine，往里面塞所有环境所需要的工具，JDK什么的，做一个环境base镜像。
	
	涉及到编译安装的还需要用alpine的系统管理工具 APK add 加系统工具，例如c++，g++编译器库之类的。
	装环境的时候报错，然后去搜索就能知道缺啥了。 （进阶：为了节省空间，add可以加--virtual参数，不安装到系统，编译完环境后再删除）
	
方式二：直接找个现成的

	有别人做好的tomcat+JDK+alpine 的环境，挑一个看得顺眼的pull下来作为我们镜像的基。



##二、构建我们自己所需的环境。

	基于最基本的环境，增加新的环境，例如我们drims环境需要R语言，
	由于docker好像不支持直接多基直接引用（可以试一下），可以一层套一层的来进行环境镜像构建。
	注：一个环境中最终只能有一个随镜像启动的程序。所以tomcat 和 mongo 就不能做到一个环境里。
	（虽然能用脚本绕过这个限制，但最好不要，一个镜像就做一件事，维护起来方便。）


方式一：对于直接发包的情况。
      
	基于（一），写Dockerfile，把工程拷入tomcat对应位置， 可以直接拷贝最终文件，无需war包。

方式二：对于边调试边发包的情况。
      
	（一）的镜像启动，得到容器，IDEA设置View–>Tool Windows–>Docker。直接对容器进行调试，调试完成，commit封装镜像，发包。

##三、发包。

方式一：把镜像的域修改为仓库地址（域名或ip），push到仓库，把镜像名字交给部署人员。

方式二：打包成zip，邮件发送。